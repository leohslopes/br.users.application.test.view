<div class="container-fluid p-0">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top shadow">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center">
        <img src="assets/LogoSistema.png" alt="UserControl Logo" style="height: 50px;">
      </a>
      <div class="d-flex align-items-center">
        <a class="nav-link text-white" *ngIf="isLoged" (click)="Logout()">Logout</a>
      </div>
    </div>
  </nav>

  <div class="row no-gutters">
    <!-- Sidebar -->
    <aside class="col-md-3 col-lg-2 bg-light border-end min-vh-100 p-3 d-none d-md-block">
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link active" routerLink="/account/dashboard" routerLinkActive="active">Dashboard</a>
        </li>
      </ul>
    </aside>

    <!-- Conteúdo principal -->
    <main class="col px-4 py-4">
      <div class="dashboard-container">
        <h2 class="title mb-4">Lista de Usuários</h2>
        <!-- Botões superiores -->
        <div class="mb-3 d-flex justify-content-start align-items-center gap-3">
          <label class="btn btn-outline-primary btn-sm m-0">
            <i class="bi bi-upload"></i> Importar CSV
            <input type="file" accept=".csv" (change)="onFileSelected($event)" hidden>
          </label>

          <button type="button" class="btn btn-outline-secondary btn-sm" (click)="download()">
            <i class="bi bi-download"></i> Exportar Logs
          </button>
        </div>
        <!-- Painel de Filtro -->
        <div class="card shadow-sm mb-4 border-secondary-subtle">
          <div class="card-header bg-light">
            <strong><i class="bi bi-funnel"></i> Filtros de Pesquisa</strong>
          </div>
          <div class="card-body">
            <form class="row g-3" [formGroup]="filterFormGroup">
              <div class="col-md-6 col-lg-4">
                <label for="filterName" class="form-label"><b>Nome:</b></label>
                <input type="text" id="filterName" class="form-control form-control-sm" formControlName="filterName"
                  placeholder="Buscar por nome">
              </div>
              <div class="col-md-6 col-lg-4">
                <label for="filterEmail" class="form-label"><b>E-mail:</b></label>
                <input type="text" id="filterEmail" class="form-control form-control-sm" formControlName="filterEmail"
                  placeholder="Buscar por e-mail">
              </div>
              <div class="col-md-6 col-lg-4">
                <label for="filterGender" class="form-label"><b>Sexo:</b></label>
                <select id="filterGender" class="form-select form-select-sm" formControlName="filterGender">
                  <option value="" disabled selected>Todos</option>
                  <option value="M">Masculino</option>
                  <option value="F">Feminino</option>
                </select>
              </div>
              <div class="col-md-6 col-lg-4 d-flex align-items-center pt-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="noImage" formControlName="filterImg">
                  <label class="form-check-label" for="noImage">Usuários sem imagem</label>
                </div>
              </div>
              <div class="col-md-6 col-lg-4 d-flex align-items-center pt-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="filterRecentUsers"
                    formControlName="filterRecentUsers">
                  <label class="form-check-label" for="filterRecentUsers">Últimos usuários adicionados</label>
                </div>
              </div>

              <div class="col-12 d-flex justify-content-center gap-2">
                <button type="submit" class="btn btn-outline-primary btn-sm" (click)="search()">
                  <i class="bi bi-search"></i> Pesquisar
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm" (click)="clear()">
                  <i class="bi bi-brush"></i> Limpar
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Painel de Tabela -->
        <div class="card shadow-sm border-secondary-subtle">
          <div class="card-header bg-light">
            <strong><i class="bi bi-table"></i> Resultado</strong>
          </div>
          <div class="card-body table-responsive p-0">
            <table class="table table-striped table-hover table-bordered m-0">
              <thead class="table-light">
                <tr>
                  <th scope="col"><b>Código</b></th>
                  <th scope="col"><b>Nome</b></th>
                  <th scope="col"><b>E-mail</b></th>
                  <th scope="col"><b>Idade </b></th>
                  <th scope="col"><b>Sexo</b></th>
                  <th scope="col"><b>Data Atualização</b></th>
                  <th scope="col"><b>Ações</b></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let u of paginatedUsers" (click)="SelectedItem(u)"
                  [ngClass]="{ 'selected-item': u === selectUser }">
                  <td data-label="Código">
                    {{ u.userID }}
                    <button type="button" class="btn btn-sm btn-secondary" title="CPF: {{ u.userOfficialNumber }}">
                      <i class="bi bi-person-video"></i>
                    </button>
                  </td>
                  <td data-label="Nome">
                    <img [src]="loadImage(u.userPicture)" alt="Foto" class="img-thumbnail">
                    {{ u.userName }}
                  </td>
                  <td data-label="E-mail">{{ u.userEmail }}</td>
                  <td data-label="Idade">{{ u.userAge }}</td>
                  <td data-label="Sexo">{{ ChangeTextGender(u.userGender) }}</td>
                  <td data-label="Atualização">{{ u.dateAlter | date:'dd/MM/yyyy HH:mm:ss' }}</td>
                  <td data-label="Ações">
                    <div class="action-buttons">
                      <button type="button" class="btn btn-sm btn-outline-success" title="Editar"
                        (click)="openViewUserModal(selectUser, $event); $event.stopPropagation()"
                        [disabled]="!selectUser">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button type="button" class="btn btn-sm btn-outline-danger" title="Excluir"
                        (click)="openDeleteUserModal(selectUser, $event); $event.stopPropagation()"
                        [disabled]="!selectUser">
                        <i class="bi bi-x-square"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td *ngIf="users?.length !== undefined" colspan="7"
                    class="text-end fw-semibold bg-light text-secondary small px-3 py-2">
                    Total de usuários: {{ users?.length }}
                  </td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>

        <!-- Paginação Corporativa -->
        <nav class="mt-3 d-flex justify-content-center">
          <ul class="pagination pagination-sm custom-pagination mb-0">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button class="page-link" (click)="currentPage = currentPage - 1" [disabled]="currentPage === 1">
                <i class="bi bi-chevron-left"></i> Anterior
              </button>
            </li>

            <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index"
              [class.active]="currentPage === i + 1">
              <button class="page-link" (click)="currentPage = i + 1">{{ i + 1 }}</button>
            </li>

            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <button class="page-link" (click)="currentPage = currentPage + 1" [disabled]="currentPage === totalPages">
                Próximo <i class="bi bi-chevron-right"></i>
              </button>
            </li>
          </ul>
        </nav>

        <!-- Modais -->
        <app-update (onSubmit)="onSubmitUpdateUser($event)" [users]="selectUser"></app-update>
        <app-delete (onSubmit)="onSubmiDeleteUser($event)" [users]="selectUser"></app-delete>
      </div>
    </main>
  </div>
</div>